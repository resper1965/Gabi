#!/usr/bin/env bash
set -euo pipefail

# Script para clonar reposit√≥rios base do ecossistema Gabi

echo "üöÄ Clonando reposit√≥rios base do ecossistema Gabi..."

# Criar diret√≥rio services se n√£o existir
mkdir -p services

# Fun√ß√£o para clonar reposit√≥rio
clone_repo() {
    local name=$1
    local url=$2
    local path="services/$name"
    
    echo "üì¶ Clonando reposit√≥rio: $name"
    
    if [ -d "$path" ]; then
        echo "‚ö†Ô∏è  Diret√≥rio $path j√° existe. Removendo..."
        rm -rf "$path"
    fi
    
    git clone "$url" "$path"
    echo "‚úÖ Reposit√≥rio $name clonado com sucesso"
}

# URLs dos reposit√≥rios base (reposit√≥rios oficiais do Agno)

# Reposit√≥rios obrigat√≥rios
REQUIRED_REPOS=(
    "agno:https://github.com/agno-agi/agno.git"
    "agent-ui:https://github.com/agno-agi/agent-ui.git"
)

# Reposit√≥rios opcionais
OPTIONAL_REPOS=(
    "ag-ui-protocol:https://github.com/ag-ui-protocol/ag-ui.git"
)

# Reposit√≥rios de refer√™ncia
REFERENCE_REPOS=(
    "agentic-rag:https://github.com/SBDI/agentic-rag.git"
)

# Reposit√≥rios customizados (forks do Gabi)
CUSTOM_REPOS=(
    "gabi-os:https://github.com/ness-ai/gabi-os.git"
    "gabi-chat:https://github.com/ness-ai/gabi-chat.git"
    "gabi-ingest:https://github.com/ness-ai/gabi-ingest.git"
)

echo "üî¥ Clonando reposit√≥rios obrigat√≥rios..."
for repo in "${REQUIRED_REPOS[@]}"; do
    IFS=':' read -r name url <<< "$repo"
    clone_repo "$name" "$url"
done

echo ""
echo "üü° Clonando reposit√≥rios opcionais..."
for repo in "${OPTIONAL_REPOS[@]}"; do
    IFS=':' read -r name url <<< "$repo"
    clone_repo "$name" "$url"
done

echo ""
echo "üü¢ Clonando reposit√≥rios de refer√™ncia..."
for repo in "${REFERENCE_REPOS[@]}"; do
    IFS=':' read -r name url <<< "$repo"
    clone_repo "$name" "$url"
done

echo ""
echo "üé® Clonando reposit√≥rios customizados (forks)..."
for repo in "${CUSTOM_REPOS[@]}"; do
    IFS=':' read -r name url <<< "$repo"
    clone_repo "$name" "$url"
done

echo ""
echo "‚úÖ Clonagem dos reposit√≥rios conclu√≠da!"
echo ""
echo "üìÅ Estrutura criada:"
echo "services/"
echo "‚îú‚îÄ‚îÄ agno/              # üî¥ Agno SDK (obrigat√≥rio)"
echo "‚îú‚îÄ‚îÄ agent-ui/          # üî¥ Agent UI Template (obrigat√≥rio)"
echo "‚îú‚îÄ‚îÄ ag-ui-protocol/    # üü° AG-UI Protocol (opcional)"
echo "‚îú‚îÄ‚îÄ agentic-rag/       # üü¢ Exemplo de RAG (refer√™ncia)"
echo "‚îú‚îÄ‚îÄ gabi-os/           # üé® Fork customizado do AgentOS"
echo "‚îú‚îÄ‚îÄ gabi-chat/         # üé® Fork customizado do chat"
echo "‚îî‚îÄ‚îÄ gabi-ingest/       # üé® Fork customizado do ingest"
echo ""
echo "üìã Pr√≥ximos passos:"
echo "1. Verificar se os reposit√≥rios existem no GitHub"
echo "2. Se n√£o existirem, criar os reposit√≥rios base primeiro"
echo "3. Fazer as customiza√ß√µes necess√°rias em cada fork"
echo "4. Atualizar os Dockerfiles para usar os reposit√≥rios corretos"
